<!DOCTYPE html>
<html>
<head>
    <title>StreamHub:Backbone - Deck Example</title>
    <script src="components/requirejs/require.js"
            type="text/javascript"></script>
    <script src="http://zor.t402.livefyre.com/wjs/v3.0.sdk/javascripts/livefyre.js"></script>
    <script type="text/javascript">
    // Require.js Config
    require.config({
      paths: {
        jquery: 'components/jquery/jquery',
        underscore: 'components/underscore/underscore',
        backbone: 'components/backbone/backbone',
        "streamhub-ticker": "main",
        mustache: 'components/mustache/mustache',
        text: 'components/requirejs-text/text'
      },
      packages: [{
        name: 'streamhub-backbone',
        location: 'components/streamhub-backbone'
      }, {
        name: 'streamhub-deck',
        location: '.'
      }],
      shim: {
        backbone: {
            deps: ['underscore', 'jquery'],
            exports: 'Backbone'
        },
        underscore: {
            exports: '_'
        },
        jquery: {
            exports: '$'
        }
      },
      urlArgs: "_=" +  (new Date()).getTime()
    });
    </script>
    <link rel="stylesheet" type="text/css" href="components/streamhub-backbone/main.css">
    <link rel="stylesheet" type="text/css" href="main.css">
    <style>
    body {
        color: #222;
        font: 14px sans-serif;
        line-height: 1.25;
        background-color: #eee;
    }
    .hub-item {
        background-color: white;
        padding-left: 0.5em;
        padding-right: 0.5em;
        margin: .25em;
        cursor: pointer;
        width: 280px;
        min-height:200px;
        display:inline-block;
        vertical-align:top;
        white-space:normal;
    }
    .sort-links a, .filter-links a {
        cursor: pointer;
        text-decoration: underline;
    }
    #post-form {
        padding-bottom: 20px;
        border-bottom: 1px solid black;
    }
    </style>
</head>
<body>
<h1>StreamHub Deck</h1>
<div id="post-form">
  User token: <br/><input id='userToken'></input><br/>
	Message: <br/><input id='newMessage' /><br/>
	<button id='postMessage'>Post</button><br/>
	<span id='status'></span>
</div>

<!-- The element to place the deck in -->
<div id="my_deck">
</div>

<script type="text/javascript">
// Now to load the example
require(['streamhub-backbone', 'streamhub-deck', 'config', 'jquery'],
function(Hub, DeckView, deckConfig, $) {
    function loadApp (sdk) {
        // Source-specific templates used by Deck View, etc. (e.g. RSS templates, Twitter templates)
        //var sources = {
        //    rss: {
        //        template: function (d) {
        //            return Mustache.compile(InstagramHtml)(d);
        //        }
        //    },
        //    twitter: {
        //        template: (function () {
        //            var i=0;
        //            return function (d) {
        //                i++;
        //                if (i%4==0) {
        //                    return CardTemplate(d);
        //                }
        //                return Mustache.compile(TwitterHtml)(d);
        //            }
        //        }())
        //    }
        //}
        
        //// Initialize DeckView, with multiple collections (articleId's)
        var collections = [];
        for (var i = 0; i < deckConfig.collections.length; i++) {
            var collectionMeta = deckConfig.collections[i];
            var col = new Hub.Collection().setRemote({
                sdk: sdk,
                siteId: collectionMeta.siteId,
                articleId: collectionMeta.articleId
            });
            col.headingTitle = collectionMeta.headingTitle;
            col.headingBody = collectionMeta.headingBody;
            collections.push(col);
        }

        // Initialize DeckView with collections
        var view = new DeckView({
            el: document.getElementById("my_deck"),
            collections: collections
        });
        view.render();

        //// Calculate proper deck scroll width
        var col_width = 307;
        //var viewport_width = $(window).width();
        $('.deck-columns').css('width', ((collections.length+1) * col_width) + ($('.deck-col').eq(0).offset().left) * collections.length);


        // Set up message posting to collection 1
	    $('#postMessage').click(function() {
	        $('#status').text('Submitting...');
	        col1._sdkCollection.setUserToken($('#userToken').val());
	        col1._sdkCollection.postContent({bodyHtml: $('#newMessage').val()}, function() {
	    		$('#status').text('Success: ' + JSON.stringify(arguments));
	    		$('#newMessage').val('');
	    	}, function() {
	    		$('#status').text('Failed: ' + JSON.stringify(arguments));
	    	});
	    	return false;
	    });
    }

    fyre.conv.load({
        network: "labs-t402.fyre.co"
    }, [{app: 'sdk'}], loadApp);
});
</script>
</body>
</html>
